<div class="ui-grid-cell-contents ui-grid-header-cell-primary-focus" style="padding: 0;">
  <span class="ui-grid-header-cell-label">
    <div class="ui-grid-header-cell-title" matToolTip="header.headerTooltip || 'Loading'">{{ header.displayName || 'Loading'}}</div>
    <span *ngIf="header.dataType" style="display: block;">{{ header.dataType || ''}}</span>
  </span>
  <span>
    <i [ngClass]="{'ui-grid-icon-up-dir': header.sort.direction == 'asc', 'ui-grid-icon-down-dir': header.sort.direction == 'desc', 'ui-grid-icon-blank': header.sort.direction == null}"></i>
  </span>
</div>
<span *ngIf="domainType" class="kylo-visual-query-table-domain-type">
  <mat-icon [ngStyle]="{'color': domainType.iconColor}" matTooltip="domainType.title">{{ domainType.icon }}</mat-icon>
</span>
<mat-menu class="ui-grid-column-menu-button" md-position-mode="target-right target" md-offset="0 42">
  <button mat-button (click)="$mdOpenMenu()" class="md-icon-button" style="line-height: 24px;">
    <i class="ui-grid-icon-angle-down">&nbsp;</i>
  </button> 
    <div mat-menu-item>
      <button mat-button (click)="header.delegate.showAnalyzeColumn(header, table)">
        <i class="material-icons">assessment&nbsp;</i> {{"views.query-table-header.analyze" | translate}}
      </button>
    </div>
    <mat-divider></mat-divider>
    <div mat-menu-item>
      <button mat-button (click)="header.delegate.renameColumn(header, table)">
        <i class="material-icons">mode_edit</i> {{"views.query-table-header.rename-column" | translate}}
      </button>
    </div>
    <div mat-menu-item>
      <button mat-button (click)="header.delegate.hideColumn(header, table)">
        <i class="material-icons">remove_circle</i> {{"views.query-table-header.hide-column" | translate}}
      </button>
    </div>
    <div mat-menu-item>
      <button mat-button (click)="header.delegate.cloneColumn(header, table)">
        <i class="material-icons">content_copy</i> {{"views.query-table-header.clone-column" | translate}}
      </button>
    </div>
    <div mat-menu-item *ngIf="availableCasts.length > 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">font_download</i> Change type
        </button>
        <div class="visual-query-column-menu">
          <div mat-menu-item *ngFor="let type of availableCasts">
            <button mat-button (click)="header.delegate.castTo(type)">
              <i class="material-icons" [ngStyle]="{'color':type.iconColor}">{{type.icon}}</i>
              {{type.name}}
            </button>
          </div>
          <mat-divider></mat-divider>
          <div mat-menu-item *ngIf="availableDomainTypes != null && availableDomainTypes.length > 0">
            <mat-menu>
              <button mat-button (click)="$mdOpenMenu()">
                <i class="material-icons">local_offer</i> Other
              </button>
              <div class="visual-query-column-menu">
                <div mat-menu-item>
                  <button mat-button (click)="header.delegate.setDomainType(header, null)"><em>None</em></button>
                </div>
                <div mat-menu-item *ngFor="let domainType of availableDomainTypes">
                  <button mat-button (click)="header.delegate.setDomainType(header, domainType.id)">
                    <i class="material-icons" [ngStyle]="{'color':domainType.iconColor}">{{domainType.icon}}</i>
                    {{domainType.title}}
                  </button>
                </div>
              </div>
            </mat-menu>
          </div>
        </div>
      </mat-menu>
    </div>
    <mat-divider></mat-divider>
    <div mat-menu-item *ngIf="header.sort.direction != 'asc'">
      <button mat-button (click)="header.delegate.sortColumn('asc', header, table)">
        <i class="ui-grid-icon-sort-alt-up">&nbsp;</i> {{"views.query-table-header.sort-ascending" | translate}}
      </button>
    </div>
    <div mat-menu-item *ngIf="header.sort.direction != 'desc'">
      <button mat-button (click)="header.delegate.sortColumn('desc', header, table)">
        <i class="ui-grid-icon-sort-alt-down">&nbsp;</i> {{"views.query-table-header.sort-descending" | translate}}
      </button>
    </div>

    <div mat-menu-item *ngIf="header.delegate.filters.length !== 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">filter_list</i> {{"views.query-table-header.filter" | translate}}
        </button>
        <div class="visual-query-column-menu visual-query-filter-menu">
          <div mat-menu-item *ngFor="let filter of header.delegate.filters">
            <i class="material-icons" [ngClass]="{'custom-icon': (filter.icon.length === 1)}">{{ filter.icon }}</i>
            <mat-form-field md-no-float>
              <input placeholder="{{ filter.label }}" type="text" ng-model="filter.term" ng-change="header.delegate.validateFilter(header,filter, table)" >
            </mat-form-field>
          </div>
          <button mat-button class="md-raised" (click)="header.delegate.applyFilters(header,header.delegate.filters, table)">
            {{"views.query-table-header.filter-apply" | translate}}
          </button>
        </div>
      </mat-menu>
    </div>

    <mat-divider *ngIf="header.delegate.transforms.defaults !== 0"></mat-divider>

    <div *ngIf="header.delegate.transforms.defaults !== 0">
      <div mat-menu-item *ngFor="let transform of header.delegate.transforms.defaults">
        <button mat-button (click)="header.delegate.transformColumn(transform, header, table)">
          <i class="material-icons" [ngClass]="{'custom-icon': (transform.icon.length === 1)}">{{ transform.icon }}</i> {{ transform.name }}
        </button>
      </div>
    </div>

    <div mat-menu-item *ngIf="header.delegate.transforms.math.length !== 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">transform</i> {{"views.query-table-header.math" | translate}}
        </button>
        <div class="visual-query-column-menu">
          <div mat-menu-item *ngFor="let transform of header.delegate.transforms.math">
            <button mat-button (click)="header.delegate.transformColumn(transform, header, table)">
              <i class="material-icons" [ngClass]="{'custom-icon': (transform.icon.length === 1)}">{{ transform.icon }}</i> {{ transform.name }}
            </button>
          </div>
        </div>
      </mat-menu>
    </div>

    <div mat-menu-item *ngIf="header.delegate.transforms.format.length !== 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">transform</i> {{"views.query-table-header.format" | translate}}
        </button>
        <div class="visual-query-column-menu">
          <div mat-menu-item *ngFor="let transform of header.delegate.transforms.format">
            <button mat-button (click)="header.delegate.transformColumn(transform, header, table)">
              <i class="material-icons" [ngClass]="{'custom-icon': (transform.icon.length === 1)}">{{ transform.icon }}</i> {{ transform.name }}
            </button>
          </div>
        </div>
      </mat-menu>
    </div>

    <div mat-menu-item *ngIf="header.delegate.transforms.replace.length !== 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">transform</i> {{"views.query-table-header.replace" | translate}}
        </button>
        <div class="visual-query-column-menu">
          <div mat-menu-item *ngFor="let transform of header.delegate.transforms.replace">
            <button mat-button (click)="header.delegate.transformColumn(transform, header, table)">
              <i class="material-icons" [ngClass]="{'custom-icon': (transform.icon.length === 1)}">{{ transform.icon }}</i> {{ transform.name }}
            </button>
          </div>
        </div>
      </mat-menu>
    </div>

    <div mat-menu-item *ngIf="header.delegate.transforms.extract.length !== 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">transform</i> {{"views.query-table-header.extract" | translate}}
        </button>
        <div class="visual-query-column-menu">
          <div mat-menu-item *ngFor="let transform of header.delegate.transforms.extract">
            <button mat-button (click)="header.delegate.transformColumn(transform, header, table)">
              <i class="material-icons" [ngClass]="{'custom-icon': (transform.icon.length === 1)}">{{ transform.icon }}</i> {{ transform.name }}
            </button>
          </div>
        </div>
      </mat-menu>
    </div>

    <div mat-menu-item *ngIf="header.delegate.transforms.ml.length !== 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">transform</i> {{"views.query-table-header.ml" | translate}}
        </button>
        <div class="visual-query-column-menu">
          <div mat-menu-item *ngFor="let transform of header.delegate.transforms.ml">
            <button mat-button (click)="header.delegate.transformColumn(transform, header, table)">
              <i class="material-icons" [ngClass]="{'custom-icon': (transform.icon.length === 1)}">{{ transform.icon }}</i> {{ transform.name }}
            </button>
          </div>
        </div>
      </mat-menu>
    </div>

    <div mat-menu-item *ngIf="header.delegate.transforms.other.length !== 0">
      <mat-menu>
        <button mat-button (click)="$mdOpenMenu()">
          <i class="material-icons">transform</i> {{"views.query-table-header.other" | translate}}
        </button>
        <div class="visual-query-column-menu">
          <div mat-menu-item *ngFor="let transform of header.delegate.transforms.other">
            <button mat-button (click)="header.delegate.transformColumn(transform, header, table)">
              <i class="material-icons" [ngClass]="{'custom-icon': (transform.icon.length === 1)}">{{ transform.icon }}</i> {{ transform.name }}
            </button>
          </div>
        </div>
      </mat-menu>
    </div>
</mat-menu>
