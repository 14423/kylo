<!--
  #%L
  thinkbig-ui-feed-manager
  %%
  Copyright (C) 2017 ThinkBig Analytics
  %%
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  
      http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  #L%
  -->
  <mat-progress-bar mode="indeterminate" *ngIf="model.loading"></mat-progress-bar>
  <div layout="row" layout-align="center start">

    <mat-card style="max-width:980px;width:980px;" flex="initial">

        <mat-card-title>
            <div layout="row" layout-align="space-between-center" flex>
                <div class="card-title" *ngIf="isNew" flex>{{'FEEDMGR.TEMPLATES.STEPPER.SELECT_TEMP' | translate}}</div>
                <div class="card-title" *ngIf="!isNew" flex>{{model.templateName}}</div>
                <h2 class="card-sub-header" [translate]="'FEEDMGR.TEMPLATES.STEPPER.SELECT.COUNTER'" [translateParams]="{before:1,after:5}"></h2>
            </div>
        </mat-card-title>

    <mat-card-content class="card-layout-body mat-padding">

        <ng-container *ngIf="isNew" [formGroup]="formGroup">
            <mat-form-field>
                <mat-select placeholder="Template" [(ngModel)]="nifiTemplateId"
                            formControlName="template" [disabled]="templateSelectionDisabled"
                            (change)="changeTemplate()" required>
                    <mat-option test="test" *ngFor="let template of templates" value="{{template.id}}">
                        {{template.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </ng-container>

        <div *ngIf="errorMessage != null && !isValid" layout="row">
            <ng-md-icon icon="error" size="20" class="error"></ng-md-icon>
            <div flex class="error layout-padding" >{{errorMessage}}</div>
        </div>

        <div layout="column" *ngIf="!model.reusableTemplate">
            <div class="md-subhead left-aligned" style="color: rgba(0,0,0,0.54); background-color: rgb(250,250,250); padding:16px;">{{'FEEDMGR.TEMPLATES.STEPPER.SELECT.TARGET_TABLE_OPTS' | translate}}</div>

            <div class="md-block layout-padding-top-bottom flex-gt-sm condensed">
                <div [(ngModel)]="model.templateTableOption" flex layout="row" (change)="onTableOptionChange()" style="display: inline-flex; justify-content: space-between;" required="true" ngDefaultControl>
                    <mat-radio-group *ngFor="let tableOption of templateTableOptions" style="display: inline-flex;" flex="30">
                        <mat-radio-button [checked]="model.templateTableOption == tableOption.type" [value]="tableOption.type">
                        </mat-radio-button>
                        <div>
                            <label>{{tableOption.displayName}}</label>
                            <mat-hint style="display: block;">{{tableOption.description}}</mat-hint>
                        </div>
                    </mat-radio-group>
                </div>
            </div>
        </div>

        <br/><br/><br/>

        <div style="display: flex; justify-content:flex-end;">
            <button (click)="cancelStepper()" mat-button matStepperPrevious style="margin-right:10px;">{{'view.main.cancel' | translate}}</button>
            <button mat-button matStepperNext [disabled]="!formGroup.valid" style="background-color: rgb(97,109,115); color: rgba(255,255,255,0.87);">
                {{'FEEDMGR.TEMPLATES.STEPPER.SELECT.CONTINUE_TO_STEP' | translate:param }}
            </button>
        </div>

    </mat-card-content>

</mat-card>

    <mat-card offsetleftfromprevious top="8" class="layout-fill"
                 style="max-width:250px;width:250px;min-width:250px;" flex="initial">
        <mat-card-title style="margin-bottom:0;">
            <div class="card-title">
                {{'FEEDMGR.TEMPLATES.STEPPER.TEMPLATE_STRING' | translate}}
                <mat-menu #mdMenu="matMenu">
                    <div *ngIf="!model.loading" style="min-width:192px;">
                        <div *ngIf="allowAdmin">
                            <button *ngIf="model.state == 'ENABLED'" mat-menu-item [disabled]="disabling" style="height:36px;" (click)="disableTemplate()">{{'view.main.disable' | translate}}</button>
                            <button *ngIf="model.state == 'DISABLED'" mat-menu-item [disabled]="enabling" style="height:36px;" (click)="enableTemplate()">{{'view.main.enable' | translate}}</button>
                            <button *ngIf="model.state == 'DISABLED' && model.feedsCount == 0" mat-menu-item style="height:36px;" (click)="confirmDeleteTemplate()">{{'view.main.delete' | translate}}</button>
                        </div>
                        <div *ngIf="allowExport && model.id != null && registeredTemplateId != null">
                            <button *ngFor="let item of templateNavigationLinks" style="text-align:left; height:36px;" (click)="templateNavigationLink(item)" class="mat-primary mat-link">{{item.linkText}}</button>
                            <a mat-menu-item style="height:36px; font-size: 14px;" href="{{model.exportUrl}}">{{'view.main.export' | translate}}</a>
                        </div>
                    </div>
                </mat-menu>
                <button mat-icon-button arial-label="Options" [matMenuTriggerFor]="mdMenu" style="float: right; margin-top: -10px;">
                    <ng-md-icon icon="more_vert"></ng-md-icon>
                </button>
            </div>
            <div layout="column" class="layout-padding-top-bottom">
            <span class="item-title" *ngIf="!model.loading">
                 <ng-md-icon icon="{{model.icon.title}}" size="20" hide-xs ng-style="{'fill':model.icon.color}" *ngIf="model.icon && model.state != 'NOT REGISTERED'">
                 </ng-md-icon>
                {{model.templateName}}</span>
            </div>
        </mat-card-title>

        <mat-card-content class="card-layout-body mat-padding" style="padding-top:0;">
            <div layout="column" class="layout-padding-top" *ngIf="model.loading">
                {{'FEEDMGR.TEMPLATES.STEPPER.SELECT.LOADING' | translate}}
            </div>
            <div layout="column" class="layout-padding-top" *ngIf="!model.loading">
                <mat-progress-linear color="accent" mode="indeterminate" *ngIf="enabling || disabling"></mat-progress-linear>

                <div layout="column" class="layout-padding-top-bottom" >
                    <span [ngClass]="{'enabled':model.state == 'ENABLED','disabled':model.state != 'ENABLED'}">
                        <ng-md-icon icon="{{model.stateIcon}}" size="20" *ngIf="model.state != 'NOT REGISTERED'"></ng-md-icon> {{model.state}}</span>
                        <mat-hint>{{'views.feed-details.State' | translate}}</mat-hint>
                </div>

                <div layout="column" class="layout-padding-top-bottom">
                    <span>{{model.updateDate | date: 'MM/dd/yyyy h:mm:ssa'}}</span>
                    <mat-hint>{{'feeds.feed-table.last-updated' | translate}}</mat-hint>
                </div>

                <div layout="column" class="layout-padding-top-bottom">
                    <span>{{model.feedsCount}}</span>
                    <mat-hint>{{'views.main.feeds' | translate}}</mat-hint>
                </div>
            </div>

        </mat-card-content>

    </mat-card>

</div>
