<!--
  #%L
  thinkbig-ui-feed-manager
  %%
  Copyright (C) 2017 ThinkBig Analytics
  %%
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  
      http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  #L%
  -->
  <mat-progress-bar mode="indeterminate" *ngIf="model.loading"></mat-progress-bar>
  <div layout="row" layout-align="center start">

    <mat-card style="max-width:980px;width:980px;" flex="initial">

        <mat-card-title>
            <div layout="row" layout-align="space-between-center" flex>
                <div class="card-title" flex>Select Template</div>
                <h2 class="card-sub-header">1 of 5</h2>
            </div>
        </mat-card-title>

    <mat-card-content class="card-layout-body mat-padding">
        
        <ng-container [formGroup]="formGroup">
            <mat-form-field>
                <mat-select placeholder="Template" [(ngModel)]="nifiTemplateId"
                            formControlName="template" [disabled]="templateSelectionDisabled" 
                            (change)="changeTemplate()" required>
                    <mat-option test="test" *ngFor="let template of templates" value="{{template.id}}">
                        {{template.name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </ng-container>

        <div *ngIf="errorMessage != null && !isValid" layout="row">
            <ng-md-icon icon="error" size="20" class="error"></ng-md-icon>
            <div flex class="error layout-padding" >{{errorMessage}}</div>
        </div>

        <div layout="column" *ngIf="!model.reusableTemplate">
            <div class="md-subhead left-aligned">Target Table Options</div>

            <div class="md-block layout-padding-top-bottom flex-gt-sm condensed" flex-gt-sm="">
                <div [(ngModel)]="model.templateTableOption" flex layout="row" (change)="onTableOptionChange()" required="true" ngDefaultControl>
                    <mat-radio-group *ngFor="let tableOption of templateTableOptions" flex="30">
                        <input type="radio" id="tableOptions" name="contact" value="{{tableOption.type}}" [checked]="model.templateTableOption == tableOption.type">
                        <label for="tableOptions">{{tableOption.displayName}}</label>
                        <mat-hint>{{tableOption.description}}</mat-hint>
                    </mat-radio-group>
                </div>
            </div>
        </div>

        <br/><br/><br/>
    </mat-card-content>

</mat-card>

    <mat-card offsetleftfromprevious top="8" class="layout-fill"
                 style="max-width:250px;width:250px;min-width:250px;" flex="initial">
        <mat-card-title>
            <div class="card-title">Template</div>
            <div layout="column" class="layout-padding-top-bottom">
            <span class="item-title" *ngIf="!model.loading">
                 <ng-md-icon icon="{{model.icon.title}}" size="20" hide-xs ng-style="{'fill':model.icon.color}" *ngIf="model.icon && model.state != 'NOT REGISTERED'">
                 </ng-md-icon>
                {{model.templateName}}</span>
            </div>
        </mat-card-title>

        <mat-card-content class="card-layout-body mat-padding">
            <div layout="column" class="layout-padding-top" *ngIf="model.loading">
                Loading Template ...
            </div>
            <div layout="column" class="layout-padding-top" *ngIf="!model.loading">
                <button class="border-btn md-button md-kylo-theme" *ngIf="model.state == 'ENABLED' && allowAdmin" [disabled]="disabling" (click)="disableTemplate()" class="border-btn">
                    DISABLE TEMPLATE
                </button>
                <button class="border-btn md-button md-kylo-theme" *ngIf="model.state == 'DISABLED' && allowAdmin" [disabled]="enabling" (click)="enableTemplate()" class="border-btn">
                    ENABLE TEMPLATE
                </button>
                <button class="border-btn-warn md-button md-kylo-theme" *ngIf="model.state == 'DISABLED' && allowAdmin && model.feedsCount ==0" (click)="confirmDeleteTemplate()" class="border-btn-warn">
                    DELETE TEMPLATE
                </button>
                <mat-progress-linear mode="indeterminate" *ngIf="enabling || disabling"></mat-progress-linear>
                
                <div layout="column" class="layout-padding-top-bottom" >
                    <span [ngClass]="{'enabled':model.state == 'ENABLED','disabled':model.state != 'ENABLED'}">
                        <ng-md-icon icon="{{model.stateIcon}}" size="20" *ngIf="model.state != 'NOT REGISTERED'"></ng-md-icon> {{model.state}}</span>
                        <mat-hint>State</mat-hint>
                </div>

                <div layout="column" class="layout-padding-top-bottom">
                    <span>{{model.updateDate | date: 'MM/dd/yyyy h:mm:ssa'}}</span>
                    <mat-hint>Last Updated</mat-hint>
                </div>

                <div layout="column" class="layout-padding-top-bottom">
                    <span>{{model.feedsCount}}</span>
                    <mat-hint>Feeds</mat-hint>
                </div>

                <div layout="column" class="item-column md-list-item-text" *ngIf="allowExport && model.id != null">
                    <ng-template *ngFor="let item of templateNavigationLinks">
                        <button style="text-align:left" *ngIf="registeredTemplateId != null" (click)="templateNavigationLink(item)" class="md-primary md-link">{{item.linkText}}</button>
                    </ng-template>
                    <a href="{{model.exportUrl}}" class="md-button md-kylo-theme">
                        <ng-md-icon icon="launch" size="20" style="fill:#F08C38"></ng-md-icon>
                        <span style="padding-left:10px;">Export</span>
                    </a>
                </div>
            </div>

        </mat-card-content>

    </mat-card>

</div>
