<define-feed-step-card [(feed)]="feed" [(step)]="step" (saved)="onSave()" [fxHide]="!feed.readonly">
  <feed-step-readonly-content>
    <div fxLayout="column">
      <div class="read-only-row" fxLayout="row">
        <div fxFlex="25" translate>VISUAL_QUERY.FEED_STEP.QUERY</div>
        <div fxFlex>{{feed.dataTransformation.sql}}</div>
      </div>
      <div class="read-only-row" fxLayout="row">
        <div fxFlex="25" translate>VISUAL_QUERY.FEED_STEP.DATA_TRANSFORMATIONS</div>
        <div fxFlex fxLayout="row">
          <mat-list fxFlex class="layout-padding-top-bottom">
            <ng-template ngFor let-item let-last="last" [ngForOf]="feed.dataTransformation.states">
              <mat-list-item>
                <ng-md-icon matListIcon [icon]="item.context.icon"></ng-md-icon>
                <p matLine [matTooltip]="item.context.name" class="tc-black">{{item.context.name}}</p>
              </mat-list-item>
              <mat-divider *ngIf="!last" class="relative"></mat-divider>
            </ng-template>
          </mat-list>
        </div>
      </div>
    </div>
  </feed-step-readonly-content>
</define-feed-step-card>

<visual-query-stepper #visualQuery *ngIf="!feed.readonly" engineName="spark" [toggleSideNavOnDestroy]="false" [showDatasources]="true" [showSaveStep]="false" [(ngModel)]="feed"
                      (cancel)="onCancelEdit()" (save)="onSave()">
</visual-query-stepper>
